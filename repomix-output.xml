This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  index.html
  manifest.json
  robots.txt
src/
  components/
    Admin/
      Admin.css
      AnnotationTool.js
      Dashboard.js
      SubmissionsList.js
    Auth/
      Auth.css
      Login.js
      Register.js
    Patient/
      Dashboard.js
      Patient.css
      Submissions.js
      UploadForm.js
  App.css
  App.js
  index.css
  index.js
  reportWebVitals.js
.gitignore
package.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/components/Admin/Admin.css">
.annotation-tool {
  padding: 20px;
  font-family: 'Helvetica', 'Arial', sans-serif;
}

.tool-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #ddd;
}

.tool-header h2 {
  margin: 0;
  color: #532E5E;
}

.patient-info h3 {
  margin: 0 0 5px 0;
  color: #333;
}

.patient-info p {
  margin: 0;
  color: #666;
  font-size: 0.9em;
}

.annotation-content {
  display: flex;
  gap: 20px;
}

.image-section {
  flex: 1;
  min-width: 0;
}

.image-container {
  position: relative;
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  background-color: #f9f9f9;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;
}

.image-navigation {
  position: absolute;
  top: 10px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  z-index: 10;
  background-color: rgba(255, 255, 255, 0.8);
  padding: 8px;
  border-radius: 4px;
  margin: 0 auto;
  width: fit-content;
}

.image-navigation button {
  padding: 5px 10px;
  background-color: #532E5E;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.image-navigation button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.tools-panel {
  width: 350px;
  background-color: #f5f5f5;
  padding: 20px;
  border-radius: 8px;
  height: fit-content;
}

.tools-panel h3 {
  margin-top: 0;
  color: #532E5E;
  border-bottom: 1px solid #ddd;
  padding-bottom: 10px;
}

.findings-form {
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #333;
}

.form-group textarea {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  resize: vertical;
  min-height: 60px;
}

.checkbox-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 15px;
}

.checkbox-group label {
  display: flex;
  align-items: center;
  font-weight: normal;
}

.checkbox-group input {
  margin-right: 8px;
}

.annotation-tools {
  margin-bottom: 20px;
}

.annotation-tools h4 {
  margin-top: 0;
  color: #532E5E;
}

.tool-buttons {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.tool-buttons button {
  padding: 8px 12px;
  background-color: #532E5E;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  flex: 1;
}

.tool-buttons button.active {
  background-color: #8E44AD;
}

.color-picker {
  margin-bottom: 15px;
}

.color-picker h5 {
  margin: 0 0 10px 0;
  color: #333;
}

.color-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  margin-bottom: 10px;
}

.color-option {
  padding: 8px;
  border-radius: 4px;
  cursor: pointer;
  text-align: center;
  color: white;
  font-weight: bold;
  font-size: 0.8em;
  transition: transform 0.2s, box-shadow 0.2s;
}

.color-option:hover {
  transform: scale(1.05);
}

.color-option.selected {
  box-shadow: 0 0 0 2px white, 0 0 0 4px #333;
}

.color-name {
  display: block;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
}

.current-color-display {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9em;
}

.color-sample {
  display: inline-block;
  width: 16px;
  height: 16px;
  border-radius: 3px;
  border: 1px solid #ddd;
}

.tool-note {
  font-size: 0.8em;
  color: #666;
  margin: 10px 0 0;
  font-style: italic;
}

.action-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.btn {
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  text-align: center;
}

.btn-primary {
  background-color: #532E5E;
  color: white;
}

.btn-success {
  background-color: #27ae60;
  color: white;
}

.btn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.btn-back {
  background-color: #95a5a6;
  color: white;
}

@media (max-width: 992px) {
  .annotation-content {
    flex-direction: column;
  }
  
  .tools-panel {
    width: 100%;
  }
}
</file>

<file path="src/components/Admin/AnnotationTool.js">
import React, { useState, useEffect, useRef } from 'react';
import './Admin.css';

const AnnotationTool = ({ submission, onBack, onSaveAnnotation }) => {
  const [findings, setFindings] = useState({
    upperTeeth: submission?.findings?.upperTeeth || '',
    frontTeeth: submission?.findings?.frontTeeth || '',
    recededGums: submission?.findings?.recededGums || false,
    stains: submission?.findings?.stains || false,
    attrition: submission?.findings?.attrition || false,
    lowerTeeth: submission?.findings?.lowerTeeth || '',
    crowns: submission?.findings?.crowns || false,
    otherFindings: submission?.findings?.otherFindings || ''
  });
  const [loading, setLoading] = useState(false);
  const [imageUrls, setImageUrls] = useState([]);
  const [currentImageIndex, setCurrentImageIndex] = useState(0);
  const [imageAnnotations, setImageAnnotations] = useState(() =>
    Array.isArray(submission?.findings?.annotations) 
      ? submission.findings.annotations
      : (Array.isArray(submission?.imageURLs)
          ? submission.imageURLs.map(() => ({ annotations: [] }))
          : [])
  );
  const [currentTool, setCurrentTool] = useState(null);
  const [isDrawing, setIsDrawing] = useState(false);
  const [startPos, setStartPos] = useState({ x: 0, y: 0 });
  const [currentColor, setCurrentColor] = useState('#532E5E');
  const canvasRef = useRef(null);
  const imageRef = useRef(null);
  const containerRef = useRef(null);
  const prevImageUrlsRef = useRef([]);

  const colorOptions = [
    { name: 'Inflammed / Red gums', value: '#532E5E' },
    { name: 'Malaligned', value: '#F5D953' },
    { name: 'Receded gums', value: '#B2A0C2' },
    { name: 'Stains', value: '#D33E3E' },
    { name: 'Attrition', value: '#58C3D1' },
    { name: 'Crowns', value: '#D93685' }
  ];

  const currentAnnotations = imageAnnotations[currentImageIndex]?.annotations || [];

  useEffect(() => {
    if (!submission) return;

    if (submission.findings) {
      setFindings(submission.findings);
    }

    if (Array.isArray(submission.imageURLs)) {
      // Initialize annotations if not present
      if (!submission.findings?.annotations) {
        setImageAnnotations(submission.imageURLs.map(() => ({ annotations: [] })));
      }
      fetchImages(submission.imageURLs);
    } else {
      setImageUrls([]);
    }

    setCurrentImageIndex(0);
  }, [submission]);

  // Fixed canvas synchronization with proper image scaling
  useEffect(() => {
    const img = imageRef.current;
    const canvas = canvasRef.current;
    const container = containerRef.current;
    
    if (!img || !canvas || !container) return;

    const handleLoad = () => {
      // Calculate displayed image dimensions (accounting for CSS scaling)
      const containerWidth = container.clientWidth;
      const scale = containerWidth / img.naturalWidth;
      const displayedHeight = img.naturalHeight * scale;
      
      // Set canvas dimensions to match displayed image size
      canvas.width = containerWidth;
      canvas.height = displayedHeight;
      
      // Update container height to match scaled image
      container.style.height = `${displayedHeight}px`;
      
      redrawCanvas();
    };

    img.addEventListener('load', handleLoad);
    // If image is already loaded, trigger manually
    if (img.complete) handleLoad();

    // Handle window resize
    const handleResize = () => {
      if (img.complete) handleLoad();
    };
    
    window.addEventListener('resize', handleResize);

    return () => {
      img.removeEventListener('load', handleLoad);
      window.removeEventListener('resize', handleResize);
    };
  }, [currentImageIndex, imageUrls]);

  useEffect(() => {
    if (imageUrls.length > 0 && canvasRef.current) redrawCanvas();
  }, [imageUrls, imageAnnotations, currentImageIndex]);

  useEffect(() => {
    return () => {
      prevImageUrlsRef.current.forEach(u => URL.revokeObjectURL(u));
      prevImageUrlsRef.current = [];
    };
  }, []);

  // Fixed coordinate calculation to account for image scaling
  const getCanvasRelativePos = (e) => {
    const canvas = canvasRef.current;
    const img = imageRef.current;
    const container = containerRef.current;
    
    if (!canvas || !img || !container) return { x: 0, y: 0 };
    
    const rect = container.getBoundingClientRect();
    const scaleX = img.naturalWidth / rect.width;
    const scaleY = img.naturalHeight / rect.height;
    
    const x = (e.clientX - rect.left) * scaleX;
    const y = (e.clientY - rect.top) * scaleY;
    
    return { x, y };
  };

  const handleMouseDown = (e) => {
    if (!currentTool) return;
    const { x, y } = getCanvasRelativePos(e);
    setStartPos({ x, y });
    setIsDrawing(true);
  };

  const handleMouseMove = (e) => {
    if (!isDrawing || !currentTool) return;
    const canvas = canvasRef.current;
    if (!canvas) return;

    const { x: currentX, y: currentY } = getCanvasRelativePos(e);
    redrawCanvas();

    const ctx = canvas.getContext('2d');
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = 2;

    if (currentTool === 'rectangle') {
      // Draw temporary rectangle while dragging
      ctx.strokeRect(startPos.x, startPos.y, currentX - startPos.x, currentY - startPos.y);
    }
  };

  const handleMouseUp = (e) => {
    if (!isDrawing || !currentTool) return;

    const { x: endX, y: endY } = getCanvasRelativePos(e);
    const pxPerCm = 37.8;
    const targetSize = 0.4 * pxPerCm;
    let newAnnotation = null;

    if (currentTool === 'rectangle') {
      const width = endX - startPos.x;
      const height = endY - startPos.y;

      if (Math.abs(width) < targetSize || Math.abs(height) < targetSize) {
        newAnnotation = {
          type: 'rectangle',
          x: startPos.x,
          y: startPos.y,
          width: targetSize,
          height: targetSize,
          color: currentColor
        };
      } else {
        newAnnotation = {
          type: 'rectangle',
          x: startPos.x,
          y: startPos.y,
          width,
          height,
          color: currentColor
        };
      }
    }

    setImageAnnotations(prev => {
      const copy = [...prev];
      if (!copy[currentImageIndex]) copy[currentImageIndex] = { annotations: [] };
      copy[currentImageIndex].annotations = [...(copy[currentImageIndex].annotations || []), newAnnotation];
      return copy;
    });

    setIsDrawing(false);
  };

  const redrawCanvas = () => {
    const canvas = canvasRef.current;
    const img = imageRef.current;
    const container = containerRef.current;
    
    if (!canvas || !img || !container) return;
    
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Calculate scaling factors
    const scaleX = canvas.width / img.naturalWidth;
    const scaleY = canvas.height / img.naturalHeight;

    const anns = imageAnnotations[currentImageIndex]?.annotations || [];
    anns.forEach(ann => {
      ctx.strokeStyle = ann.color;
      ctx.lineWidth = 2;
      
      if (ann.type === 'rectangle') {
        // Scale the annotation coordinates to match the displayed image size
        const x = ann.x * scaleX;
        const y = ann.y * scaleY;
        const width = ann.width * scaleX;
        const height = ann.height * scaleY;
        
        ctx.strokeRect(x, y, width, height);
      }
    });
  };

  const fetchImages = async (imagePaths) => {
    if (!Array.isArray(imagePaths) || imagePaths.length === 0) {
      setImageUrls([]);
      return;
    }

    try {
      const token = localStorage.getItem('token');
      const urls = [];

      prevImageUrlsRef.current.forEach(u => URL.revokeObjectURL(u));
      prevImageUrlsRef.current = [];

      for (const imagePath of imagePaths) {
        const res = await fetch('http://localhost:3001/admin/get-image', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ imagePath })
        });

        if (!res.ok) throw new Error('Image not found');
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        urls.push(url);
        prevImageUrlsRef.current.push(url);
      }

      setImageUrls(urls);
    } catch (err) {
      console.error('Error fetching images:', err);
      setImageUrls([]);
      prevImageUrlsRef.current.forEach(u => URL.revokeObjectURL(u));
      prevImageUrlsRef.current = [];
    }
  };

  const nextImage = () => {
    setCurrentImageIndex(i => Math.min(i + 1, imageUrls.length - 1));
  };

  const prevImage = () => {
    setCurrentImageIndex(i => Math.max(i - 1, 0));
  };

  const handleFindingChange = (field, value) => {
    setFindings(prev => ({ ...prev, [field]: value }));
  };

  // Modified to only save to backend without downloading
  const handleGenerateReport = async () => {
    setLoading(true);
    try {
      const token = localStorage.getItem('token');
      const response = await fetch(
        `http://localhost:3001/admin/submission/${submission._id}/generate-report`,
        {
          method: 'POST',
          headers: { Authorization: `Bearer ${token}` }
        }
      );

      if (!response.ok) {
        const err = await response.text();
        alert(err || 'Failed to generate report');
        return;
      }

      alert('Report generated successfully!');
    } catch (error) {
      console.error('Error generating report:', error);
      alert('Error generating report');
    } finally {
      setLoading(false);
    }
  };

  // Fixed annotation saving
  const handleSave = async () => {
    setLoading(true);
    try {
      const token = localStorage.getItem('token');
      const findingsWithAnnotations = { 
        ...findings, 
        annotations: imageAnnotations 
      };

      const response = await fetch(
        `http://localhost:3001/admin/submission/${submission._id}/annotate`,
        {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json', 
            Authorization: `Bearer ${token}` 
          },
          body: JSON.stringify({ findings: findingsWithAnnotations })
        }
      );

      const data = await response.json();
      if (response.ok) {
        alert('Annotations saved successfully!');
        if (onSaveAnnotation) onSaveAnnotation(data.submission);
      } else {
        alert(data.message || 'Error saving annotations');
      }
    } catch (error) {
      console.error(error);
      alert('Error saving annotations');
    } finally {
      setLoading(false);
    }
  };

  const clearAnnotations = () => {
    setImageAnnotations(prev => {
      const copy = [...prev];
      if (!copy[currentImageIndex]) copy[currentImageIndex] = { annotations: [] };
      copy[currentImageIndex].annotations = [];
      return copy;
    });
  };

  return (
    <div className="annotation-tool">
      <div className="tool-header">
        <button onClick={onBack} className="btn btn-back">&larr; Back to List</button>
        <h2>Annotation Tool</h2>
        <div className="patient-info">
          <h3>{submission.name} (ID: {submission.patientID})</h3>
          <p>Phone: {submission.phone} | Submitted: {new Date(submission.createdAt).toLocaleDateString()}</p>
        </div>
      </div>

      <div className="annotation-content">
        <div className="image-section">
          <div className="image-container" ref={containerRef}>
            {imageUrls.length > 0 ? (
              <>
                <div className="image-navigation">
                  <button onClick={prevImage} disabled={currentImageIndex === 0}>Previous</button>
                  <span>Image {currentImageIndex + 1} of {imageUrls.length}</span>
                  <button onClick={nextImage} disabled={currentImageIndex === imageUrls.length - 1}>Next</button>
                </div>

                <img
                  ref={imageRef}
                  src={imageUrls[currentImageIndex]}
                  alt="Teeth for annotation"
                  style={{ display: 'block', width: '100%', height: 'auto' }}
                />

                <canvas
                  ref={canvasRef}
                  style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    cursor: currentTool ? 'crosshair' : 'default',
                    zIndex: 1,
                    pointerEvents: currentTool ? 'auto' : 'none'
                  }}
                  onMouseDown={handleMouseDown}
                  onMouseMove={handleMouseMove}
                  onMouseUp={handleMouseUp}
                />
              </>
            ) : (
              <p>Loading images...</p>
            )}
          </div>
        </div>

        <div className="tools-panel">
          <h3>Dental Findings</h3>

          <div className="findings-form">
            <div className="form-group">
              <label>Upper Teeth:</label>
              <textarea 
                value={findings.upperTeeth} 
                onChange={(e) => handleFindingChange('upperTeeth', e.target.value)}
                rows="3"
              />
            </div>
            
            <div className="form-group">
              <label>Front Teeth:</label>
              <textarea 
                value={findings.frontTeeth} 
                onChange={(e) => handleFindingChange('frontTeeth', e.target.value)}
                rows="3"
              />
            </div>
            
            <div className="form-group">
              <label>Lower Teeth:</label>
              <textarea 
                value={findings.lowerTeeth} 
                onChange={(e) => handleFindingChange('lowerTeeth', e.target.value)}
                rows="3"
              />
            </div>
            
            <div className="checkbox-group">
              <label>
                <input 
                  type="checkbox" 
                  checked={findings.recededGums} 
                  onChange={(e) => handleFindingChange('recededGums', e.target.checked)}
                />
                Receded Gums
              </label>
              
              <label>
                <input 
                  type="checkbox" 
                  checked={findings.stains} 
                  onChange={(e) => handleFindingChange('stains', e.target.checked)}
                />
                Stains
              </label>
              
              <label>
                <input 
                  type="checkbox" 
                  checked={findings.attrition} 
                  onChange={(e) => handleFindingChange('attrition', e.target.checked)}
                />
                Attrition
              </label>
              
              <label>
                <input 
                  type="checkbox" 
                  checked={findings.crowns} 
                  onChange={(e) => handleFindingChange('crowns', e.target.checked)}
                />
                Crowns
              </label>
            </div>
            
            <div className="form-group">
              <label>Other Findings:</label>
              <textarea 
                value={findings.otherFindings} 
                onChange={(e) => handleFindingChange('otherFindings', e.target.value)}
                rows="3"
              />
            </div>
          </div>

          <div className="annotation-tools">
            <h4>Annotation Tools</h4>
            <div className="tool-buttons">
              <button 
                className={currentTool === 'rectangle' ? 'active' : ''} 
                onClick={() => setCurrentTool('rectangle')}
              >
                Rectangle
              </button>
              <button onClick={clearAnnotations}>Clear Annotations</button>
            </div>

            <div className="color-picker">
              <h5>Condition Colors</h5>
              <div className="color-options">
                {colorOptions.map((color, index) => (
                  <div
                    key={index}
                    className={`color-option ${currentColor === color.value ? 'selected' : ''}`}
                    style={{ backgroundColor: color.value }}
                    title={color.name}
                    onClick={() => setCurrentColor(color.value)}
                  >
                    <span className="color-name">{color.name}</span>
                  </div>
                ))}
              </div>

              <div className="current-color-display">
                Selected: <span className="color-sample" style={{ backgroundColor: currentColor }}></span>
                {colorOptions.find(c => c.value === currentColor)?.name}
              </div>
            </div>

            <p className="tool-note">Click and drag to draw rectangles (approx. 0.4 cm size)</p>
          </div>

          <div className="action-buttons">
            <button onClick={handleSave} disabled={loading} className="btn btn-primary">
              {loading ? 'Saving...' : 'Save Findings'}
            </button>
            <button onClick={handleGenerateReport} disabled={loading} className="btn btn-success">
              {loading ? 'Generating...' : 'Generate PDF Report'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AnnotationTool;
</file>

<file path="src/components/Admin/Dashboard.js">
import React, { useState } from 'react';
import SubmissionsList from './SubmissionsList';
import AnnotationTool from './AnnotationTool';
import './Admin.css';

const AdminDashboard = () => {
  const [activeView, setActiveView] = useState('submissions');
  const [selectedSubmission, setSelectedSubmission] = useState(null);

  const handleSelectSubmission = (submission) => {
    setSelectedSubmission(submission);
    setActiveView('annotation');
  };

  const handleBackToList = () => {
    setSelectedSubmission(null);
    setActiveView('submissions');
  };

  return (
    <div className="admin-dashboard">
      <div className="dashboard-header">
        <h1>Admin Dashboard</h1>
        <p>OralVis Healthcare Professional Portal</p>
      </div>
      
      {activeView === 'submissions' && (
        <SubmissionsList onSelectSubmission={handleSelectSubmission} />
      )}
      
      {activeView === 'annotation' && selectedSubmission && (
        <AnnotationTool 
          submission={selectedSubmission} 
          onBack={handleBackToList}
        />
      )}
    </div>
  );
};

export default AdminDashboard;
</file>

<file path="src/components/Admin/SubmissionsList.js">
// src/components/Admin/SubmissionsList.js
import React, { useState, useEffect } from 'react';
import './Admin.css';

const SubmissionsList = ({ onSelectSubmission, refresh }) => {
  const [submissions, setSubmissions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [filter, setFilter] = useState('all');
  const [imageUrls, setImageUrls] = useState({});

  useEffect(() => {
    fetchSubmissions();
  }, [refresh]);

  const fetchSubmissions = async () => {
    try {
      const token = localStorage.getItem('token');
      const response = await fetch('http://localhost:3001/admin/submissions', {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (response.ok) {
        const data = await response.json();
        setSubmissions(data);
        data.forEach(sub => fetchFirstImage(sub));
      } else {
        console.error('Failed to fetch submissions');
      }
    } catch (error) {
      console.error('Error fetching submissions:', error);
    } finally {
      setLoading(false);
    }
  };

  const fetchFirstImage = async (submission) => {
    try {
      if (!submission.imageURLs || submission.imageURLs.length === 0) return;

      const token = localStorage.getItem('token');
      const res = await fetch('http://localhost:3001/admin/get-image', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ imagePath: submission.imageURLs[0] })
      });

      if (!res.ok) throw new Error('Image not found');
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      setImageUrls(prev => ({ ...prev, [submission._id]: url }));
    } catch (err) {
      console.error(`Error fetching image for ${submission._id}:`, err);
    }
  };

  const filteredSubmissions = filter === 'all'
    ? submissions
    : submissions.filter(s => s.status === filter);

  if (loading) return <div className="loading">Loading submissions...</div>;

  return (
    <div className="submissions-list">
      <div className="list-header">
        <h2>Patient Submissions ({submissions.length})</h2>
        <div className="filters">
          <button className={filter === 'all' ? 'active' : ''} onClick={() => setFilter('all')}>All</button>
          <button className={filter === 'uploaded' ? 'active' : ''} onClick={() => setFilter('uploaded')}>New</button>
          <button className={filter === 'annotated' ? 'active' : ''} onClick={() => setFilter('annotated')}>Annotated</button>
          <button className={filter === 'reported' ? 'active' : ''} onClick={() => setFilter('reported')}>Reported</button>
        </div>
      </div>

      {filteredSubmissions.length === 0 ? (
        <div className="no-submissions"><p>No submissions found.</p></div>
      ) : (
        <div className="submissions-grid">
          {filteredSubmissions.map(sub => (
            <div key={sub._id} className="submission-card">
              <div className="submission-image">
                {imageUrls[sub._id] ? (
                  <img src={imageUrls[sub._id]} alt="Teeth" style={{ width: '100%' }} />
                ) : <p>Loading image...</p>}
              </div>
              <div className="submission-details">
                <h3>{sub.name}</h3>
                <p>ID: {sub.patientID}</p>
                <p>Phone: {sub.phone}</p>
                <p>Date: {new Date(sub.createdAt).toLocaleDateString()}</p>
                <p className={`status ${sub.status}`}>Status: {sub.status}</p>
              </div>
              <div className="submission-actions">
                <button onClick={() => onSelectSubmission(sub)} className="btn btn-primary">
                  {sub.status === 'uploaded' ? 'Annotate' : 'View'}
                </button>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default SubmissionsList;
</file>

<file path="src/components/Auth/Auth.css">
.auth-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
  padding: 20px;
}

.auth-form {
  width: 100%;
  max-width: 450px;
  padding: 30px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
}

.auth-form h2 {
  text-align: center;
  margin-bottom: 25px;
  color: #2c3e50;
  font-weight: 600;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #34495e;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 16px;
  transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  border-color: #3498db;
  outline: none;
}

button {
  width: 100%;
  padding: 12px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.3s;
  margin-top: 10px;
}

button:hover {
  background-color: #2980b9;
}

button:disabled {
  background-color: #95a5a6;
  cursor: not-allowed;
}

.error-message {
  color: #e74c3c;
  margin-bottom: 15px;
  padding: 10px;
  background-color: #fadbd8;
  border-radius: 6px;
  border-left: 4px solid #e74c3c;
}

.auth-link {
  text-align: center;
  margin-top: 20px;
  color: #7f8c8d;
}

.auth-link a {
  color: #3498db;
  text-decoration: none;
  font-weight: 500;
}

.auth-link a:hover {
  text-decoration: underline;
}

.demo-credentials {
  margin-top: 20px;
  padding: 15px;
  background-color: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid #3498db;
}

.demo-credentials h4 {
  margin: 0 0 10px 0;
  color: #2c3e50;
}

.demo-credentials p {
  margin: 5px 0;
  font-size: 14px;
  color: #7f8c8d;
}
</file>

<file path="src/components/Auth/Login.js">
// src/components/Auth/Login.js
import React, { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import './Auth.css';

const Login = ({ onLogin }) => {
  const [formData, setFormData] = useState({
    email: '',
    password: ''
  });
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const response = await fetch('http://localhost:3001/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      });

      const data = await response.json();

      if (response.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));
        onLogin(data.user);
        navigate(data.user.role === 'admin' ? '/admin' : '/patient');
      } else {
        setError(data.message || 'Login failed');
      }
    } catch (err) {
      setError('Login failed. Please try again.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="auth-container">
      <div className="auth-form">
        <h2>Login to OralVis</h2>
        {error && <div className="error-message">{error}</div>}
        <form onSubmit={handleSubmit}>
          <div className="form-group">
            <label htmlFor="email">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              value={formData.email}
              onChange={handleChange}
              required
            />
          </div>
          <div className="form-group">
            <label htmlFor="password">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              value={formData.password}
              onChange={handleChange}
              required
            />
          </div>
          <button disabled={loading} type="submit">
            {loading ? 'Logging in...' : 'Login'}
          </button>
        </form>
        <div className="demo-credentials">
          <h4>Demo Credentials:</h4>
          <p>Admin: admin@oralvis.com / admin123</p>
          <p>Patient: patient@oralvis.com / patient123</p>
        </div>
        <div className="auth-link">
          Don't have an account? <Link to="/register">Register here</Link>
        </div>
      </div>
    </div>
  );
};

export default Login;
</file>

<file path="src/components/Auth/Register.js">
import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import './Auth.css';

const Register = ({ onLogin }) => {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    confirmPassword: '',
    role: 'patient'
  });
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (formData.password !== formData.confirmPassword) {
      return setError('Passwords do not match');
    }

    setLoading(true);
    setError('');

    try {
      const response = await fetch('http://localhost:3001/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: formData.name,
          email: formData.email,
          password: formData.password,
          role: formData.role
        })
      });

      const data = await response.json();

      if (response.ok) {
        // Store token and user data
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));
        
        // Call the onLogin callback if provided
        if (onLogin) {
          onLogin(data.user);
        }
        
        // Redirect based on role
        if (formData.role === 'admin') {
          navigate('/admin');
        } else {
          navigate('/patient');
        }
      } else {
        setError(data.message || 'Registration failed. Please try again.');
      }
    } catch (err) {
      setError('Registration failed. Please check your connection and try again.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="auth-container">
      <div className="auth-form">
        <h2>Create an Account</h2>
        {error && <div className="error-message">{error}</div>}
        <form onSubmit={handleSubmit}>
          <div className="form-group">
            <label htmlFor="name">Full Name</label>
            <input
              type="text"
              id="name"
              name="name"
              value={formData.name}
              onChange={handleChange}
              required
            />
          </div>
          <div className="form-group">
            <label htmlFor="email">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              value={formData.email}
              onChange={handleChange}
              required
            />
          </div>
          <div className="form-group">
            <label htmlFor="password">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              value={formData.password}
              onChange={handleChange}
              required
            />
          </div>
          <div className="form-group">
            <label htmlFor="confirmPassword">Confirm Password</label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              value={formData.confirmPassword}
              onChange={handleChange}
              required
            />
          </div>
          <div className="form-group">
            <label htmlFor="role">I am a</label>
            <select
              id="role"
              name="role"
              value={formData.role}
              onChange={handleChange}
            >
              <option value="patient">Patient</option>
              <option value="admin">Dental Professional</option>
            </select>
          </div>
          <button disabled={loading} type="submit">
            {loading ? 'Creating account...' : 'Register'}
          </button>
        </form>
        <div className="auth-link">
          Already have an account? <Link to="/login">Login here</Link>
        </div>
      </div>
    </div>
  );
};

export default Register;
</file>

<file path="src/components/Patient/Dashboard.js">
import React, { useState } from 'react';
import UploadForm from './UploadForm';
import Submissions from './Submissions';
import './Patient.css';

const PatientDashboard = () => {
  const [activeTab, setActiveTab] = useState('upload');

  return (
    <div className="patient-dashboard">
      <div className="dashboard-header">
        <h1>Patient Dashboard</h1>
        <p>Welcome to OralVis Healthcare</p>
      </div>
      
      <div className="dashboard-nav">
        <button 
          className={activeTab === 'upload' ? 'active' : ''}
          onClick={() => setActiveTab('upload')}
        >
          Upload New
        </button>
        <button 
          className={activeTab === 'submissions' ? 'active' : ''}
          onClick={() => setActiveTab('submissions')}
        >
          My Submissions
        </button>
      </div>
      
      <div className="dashboard-content">
        {activeTab === 'upload' && <UploadForm />}
        {activeTab === 'submissions' && <Submissions />}
      </div>
    </div>
  );
};

export default PatientDashboard;
</file>

<file path="src/components/Patient/Patient.css">
.patient-dashboard {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
}

.dashboard-header {
  text-align: center;
  margin-bottom: 30px;
}

.dashboard-header h1 {
  color: #2c3e50;
  margin-bottom: 10px;
}

.dashboard-header p {
  color: #7f8c8d;
  font-size: 18px;
}

.dashboard-nav {
  display: flex;
  justify-content: center;
  margin-bottom: 30px;
  border-bottom: 1px solid #ecf0f1;
}

.dashboard-nav button {
  padding: 12px 24px;
  background: none;
  border: none;
  font-size: 16px;
  font-weight: 500;
  color: #7f8c8d;
  cursor: pointer;
  transition: all 0.3s;
  border-bottom: 3px solid transparent;
}

.dashboard-nav button:hover {
  color: #3498db;
}

.dashboard-nav button.active {
  color: #3498db;
  border-bottom: 3px solid #3498db;
}

.dashboard-content {
  background: white;
  border-radius: 10px;
  padding: 30px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.upload-form {
  max-width: 600px;
  margin: 0 auto;
}

.upload-form h2 {
  color: #2c3e50;
  margin-bottom: 25px;
  text-align: center;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #34495e;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 16px;
  transition: border-color 0.3s;
}

.form-group input:focus,
.form-group textarea:focus {
  border-color: #3498db;
  outline: none;
}

.form-group textarea {
  resize: vertical;
  min-height: 100px;
}

.file-hint {
  font-size: 14px;
  color: #7f8c8d;
  margin-top: 5px;
}

button {
  padding: 12px 24px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.3s;
}

button:hover {
  background-color: #2980b9;
}

button:disabled {
  background-color: #95a5a6;
  cursor: not-allowed;
}

.message {
  padding: 12px 15px;
  margin-bottom: 20px;
  border-radius: 6px;
  text-align: center;
}

.message.success {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #7f8c8d;
}

.submissions h2 {
  color: #2c3e50;
  margin-bottom: 25px;
  text-align: center;
}

.no-submissions {
  text-align: center;
  padding: 40px;
  color: #7f8c8d;
}

.submissions-list {
  display: grid;
  gap: 20px;
}

.submission-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  background-color: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #3498db;
}

.submission-info h3 {
  margin: 0 0 10px 0;
  color: #2c3e50;
}

.status {
  margin: 0;
  font-weight: 500;
}

.status.reviewed {
  color: #27ae60;
}

.status.in-progress {
  color: #f39c12;
}

.btn {
  padding: 8px 16px;
  border-radius: 4px;
  text-decoration: none;
  font-weight: 500;
  transition: background-color 0.3s;
}

.btn-primary {
  background-color: #3498db;
  color: white;
}

.btn-primary:hover {
  background-color: #2980b9;
}
</file>

<file path="src/components/Patient/Submissions.js">
import React, { useState, useEffect } from 'react';
import './Patient.css';

const Submissions = () => {
  const [submissions, setSubmissions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');

  useEffect(() => {
    fetchSubmissions();
  }, []);

  const fetchSubmissions = async () => {
    try {
      setError('');
      const token = localStorage.getItem('token');
      if (!token) {
        setError('No authentication token found');
        setLoading(false);
        return;
      }

      const response = await fetch('http://localhost:3001/patient/submissions', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        setSubmissions(data);
      } else {
        const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
        setError(errorData.message || 'Failed to fetch submissions');
        console.error('Failed to fetch submissions:', errorData);
      }
    } catch (error) {
      setError('Error fetching submissions: ' + error.message);
      console.error('Error fetching submissions:', error);
    } finally {
      setLoading(false);
    }
  };
  const downloadReport = async (submissionId) => {
    try {
      const token = localStorage.getItem('token');
      const response = await fetch(`http://localhost:3001/patient/submission/${submissionId}/report`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        // Create a blob from the PDF stream
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `oral_health_report_${submissionId}.pdf`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      } else {
        alert('Failed to download report');
      }
    } catch (error) {
      console.error('Error downloading report:', error);
      alert('Error downloading report');
    }
  };

  if (loading) {
    return <div className="loading">Loading your submissions...</div>;
  }

  return (
    <div className="submissions">
      <h2>My Submissions</h2>
      {submissions.length === 0 ? (
        <div className="no-submissions">
          <p>You haven't made any submissions yet.</p>
          <p>Upload a teeth photo to get started!</p>
        </div>
      ) : (
        <div className="submissions-list">
          {submissions.map(submission => (
            <div key={submission._id} className="submission-card">
              <div className="submission-info">
                <h3>Submission from {new Date(submission.createdAt).toLocaleDateString()}</h3>
                <p className={`status ${submission.status.toLowerCase().replace(' ', '-')}`}>
                  Status: {submission.status}
                </p>
              </div>
              <div className="submission-actions">
                {submission.status === 'reported' && (
                  <button 
                    onClick={() => downloadReport(submission._id)}
                    className="btn btn-primary"
                  >
                    Download Report
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default Submissions;
</file>

<file path="src/components/Patient/UploadForm.js">
// src/components/Patient/UploadForm.js
import React, { useState } from 'react';
import './Patient.css';

const UploadForm = () => {
  const [formData, setFormData] = useState({
    name: '',
    patientId: '',
    email: '',
    phone: '',
    note: '',
    images: [] // store multiple images here
  });
  const [uploading, setUploading] = useState(false);
  const [message, setMessage] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleFileChange = (e) => {
    const files = Array.from(e.target.files);
    if (files.length !== 3) {
      setMessage('Please select exactly 3 images (upper, front, and lower teeth)');
      return;
    }
    setMessage('');
    setFormData(prev => ({ ...prev, images: files }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setUploading(true);
    setMessage('');

    try {
      const formDataToSend = new FormData();
      formDataToSend.append('name', formData.name);
      formDataToSend.append('patientID', formData.patientId);
      formDataToSend.append('email', formData.email);
      formDataToSend.append('phone', formData.phone);
      formDataToSend.append('note', formData.note);

      // append all selected images under the same key 'images'
      if (formData.images && formData.images.length) {
        formData.images.forEach(file => {
          formDataToSend.append('images', file); // backend must expect upload.array('images', 3)
        });
      }

      const token = localStorage.getItem('token');

      const response = await fetch('http://localhost:3001/patient/upload', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`
        },
        body: formDataToSend
      });

      const data = await response.json();

      if (response.ok) {
        setMessage('Submission uploaded successfully! Your dental professional will review it shortly.');
        setFormData({
          name: '',
          patientId: '',
          email: '',
          phone: '',
          note: '',
          images: []
        });
        // reset file input
        document.getElementById('images').value = '';
      } else {
        setMessage(data.message || 'Error uploading submission');
      }
    } catch (error) {
      setMessage('Error uploading submission. Please try again.');
    } finally {
      setUploading(false);
    }
  };

  return (
    <div className="upload-form">
      <h2>Upload Teeth Photos</h2>
      {message && <div className="message success">{message}</div>}
      <form onSubmit={handleSubmit}>
        <div className="form-group">
          <label>Name</label>
          <input
            type="text"
            name="name"
            value={formData.name}
            onChange={handleChange}
            required
          />
        </div>
        <div className="form-group">
          <label>Patient ID</label>
          <input
            type="text"
            name="patientId"
            value={formData.patientId}
            onChange={handleChange}
            required
          />
        </div>
        <div className="form-group">
          <label>Email</label>
          <input
            type="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            required
          />
        </div>
        <div className="form-group">
          <label>Phone</label>
          <input
            type="tel"
            name="phone"
            value={formData.phone}
            onChange={handleChange}
            required
          />
        </div>
        <div className="form-group">
          <label>Note</label>
          <textarea
            name="note"
            value={formData.note}
            onChange={handleChange}
            rows="3"
            placeholder="Any specific concerns or notes for the dental professional?"
          />
        </div>
        <div className="form-group">
          <label>Teeth Photos</label>
          <input
            type="file"
            id="images"
            accept="image/*"
            multiple
            onChange={handleFileChange}
            required
          />
          <p className="file-hint">Upload exactly 3 clear photos of your teeth (upper, front, lower)</p>
        </div>
        <button type="submit" disabled={uploading}>
          {uploading ? 'Uploading...' : 'Submit'}
        </button>
      </form>
    </div>
  );
};

export default UploadForm;
</file>

<file path="public/index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
</file>

<file path="public/manifest.json">
{
  "short_name": "React App",
  "name": "Create React App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}
</file>

<file path="public/robots.txt">
# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:
</file>

<file path="src/App.css">
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f8f9fa;
  color: #333;
  line-height: 1.6;
}

.App {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.app-header {
  background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
  color: white;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.app-header h1 {
  font-size: 24px;
  font-weight: 600;
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 15px;
}

.btn-logout {
  padding: 6px 12px;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.btn-logout:hover {
  background: rgba(255, 255, 255, 0.3);
}

.app-main {
  flex: 1;
  padding: 20px;
}

.app-footer {
  background-color: #2c3e50;
  color: white;
  text-align: center;
  padding: 15px;
  margin-top: auto;
}

/* Responsive design */
@media (max-width: 768px) {
  .app-header {
    flex-direction: column;
    gap: 10px;
    text-align: center;
  }
  
  .annotation-content {
    grid-template-columns: 1fr !important;
  }
  
  .submissions-grid {
    grid-template-columns: 1fr !important;
  }
  
  .list-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .tool-header {
    flex-direction: column;
    align-items: flex-start;
  }
}
</file>

<file path="src/App.js">
// src/App.js
import React, { useState, useEffect } from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import Login from './components/Auth/Login';
import Register from './components/Auth/Register';
import PatientDashboard from './components/Patient/Dashboard';
import AdminDashboard from './components/Admin/Dashboard';
import './App.css';

function App() {
  const [user, setUser] = useState(null);

  useEffect(() => {
    // Check if user is logged in
    const userData = localStorage.getItem('user');
    const token = localStorage.getItem('token');
    
    // Check if userData is not "undefined" string and is valid JSON
    if (userData && userData !== "undefined" && token) {
      try {
        const parsedUser = JSON.parse(userData);
        setUser(parsedUser);
      } catch (error) {
        console.error('Error parsing user data:', error);
        // Clear invalid data from localStorage
        localStorage.removeItem('user');
        localStorage.removeItem('token');
      }
    } else if (userData === "undefined") {
      // Clean up the "undefined" string if it exists
      localStorage.removeItem('user');
      localStorage.removeItem('token');
    }
  }, []);

  const handleLogin = (userData) => {
    // Ensure userData has the expected structure
    const user = {
      id: userData.id || userData._id,
      name: userData.name,
      email: userData.email,
      role: userData.role
    };
    
    setUser(user);
    localStorage.setItem('user', JSON.stringify(user));
  };

  const handleLogout = () => {
    setUser(null);
    localStorage.removeItem('user');
    localStorage.removeItem('token');
  };

  return (
    <Router>
      <div className="App">
        <header className="app-header">
          <h1>OralVis Healthcare</h1>
          {user && (
            <div className="user-menu">
              <span>Welcome, {user.name} ({user.role})</span>
              <button onClick={handleLogout} className="btn-logout">
                Logout
              </button>
            </div>
          )}
        </header>

        <main className="app-main">
          <Routes>
            <Route 
              path="/" 
              element={
                user ? (
                  <Navigate to={user.role === 'admin' ? '/admin' : '/patient'} />
                ) : (
                  <Navigate to="/login" />
                )
              } 
            />
            <Route 
              path="/login" 
              element={
                user ? (
                  <Navigate to={user.role === 'admin' ? '/admin' : '/patient'} />
                ) : (
                  <Login onLogin={handleLogin} />
                )
              } 
            />
            <Route 
              path="/register" 
              element={
                user ? (
                  <Navigate to={user.role === 'admin' ? '/admin' : '/patient'} />
                ) : (
                  <Register onLogin={handleLogin} />
                )
              } 
            />
            <Route 
              path="/patient/*" 
              element={
                user && user.role === 'patient' ? (
                  <PatientDashboard />
                ) : (
                  <Navigate to="/login" />
                )
              } 
            />
            <Route 
              path="/admin/*" 
              element={
                user && user.role === 'admin' ? (
                  <AdminDashboard />
                ) : (
                  <Navigate to="/login" />
                )
              } 
            />
          </Routes>
        </main>

        <footer className="app-footer">
          <p>&copy; 2023 OralVis Healthcare. All rights reserved.</p>
        </footer>
      </div>
    </Router>
  );
}

export default App;
</file>

<file path="src/index.css">
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
</file>

<file path="src/index.js">
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();
</file>

<file path="src/reportWebVitals.js">
const reportWebVitals = onPerfEntry => {
  if (onPerfEntry && onPerfEntry instanceof Function) {
    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      getCLS(onPerfEntry);
      getFID(onPerfEntry);
      getFCP(onPerfEntry);
      getLCP(onPerfEntry);
      getTTFB(onPerfEntry);
    });
  }
};

export default reportWebVitals;
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# production
/build

# misc
.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local

npm-debug.log*
yarn-debug.log*
yarn-error.log*
</file>

<file path="package.json">
{
  "name": "oralvis-frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.8.0",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^13.5.0",
    "html2canvas": "^1.4.1",
    "jspdf": "^3.0.2",
    "konva": "^10.0.2",
    "pdf-lib": "^1.17.1",
    "react": "^19.1.1",
    "react-dom": "^19.1.1",
    "react-konva": "^19.0.10",
    "react-router-dom": "^7.8.2",
    "react-scripts": "^0.0.0",
    "use-image": "^1.1.4",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
</file>

</files>
